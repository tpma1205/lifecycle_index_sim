<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>指數投資配合生命週期模擬器</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>📊 指數投資配合生命週期模擬器</h1>
        <p>計算您的理財目標達成年齡與退休資金規劃</p>
      </header>

      <main>
        <section class="input-section">
          <h2>📝 基本資料設定</h2>
          <div class="form-grid">
            <div class="form-group">
              <label for="currentAge">當前年齡</label>
              <input
                type="number"
                id="currentAge"
                placeholder="例：30"
                value="30"
                min="20"
                max="80"
                oninput="updateLeverageInputsState()"
              />
            </div>
            <div class="form-group">
              <label for="currentNW">當前淨資產（萬元）</label>
              <input
                type="number"
                id="currentNW"
                placeholder="例：100"
                value="100"
                min="0"
              />
            </div>
            <div class="form-group">
              <label for="monthlyInv">每月投入金額（元）</label>
              <input
                type="number"
                id="monthlyInv"
                placeholder="例：10000"
                value="10000"
                min="0"
              />
            </div>
            <div class="form-group">
              <label for="annualReturn">
                <span class="tooltip-container">
                  💡
                  <span class="tooltip-text"
                    >預設以指數型ETF的年化報酬率設定，以台灣50、標普500為例，通常為7%~10%。</span
                  >
                </span>
                預期年化報酬率（%）</label
              >
              <input
                type="number"
                id="annualReturn"
                placeholder="例：8"
                value="8"
                min="0"
                max="20"
                step="0.5"
              />
            </div>
            <div class="form-group">
              <label for="annualVolatility">
                <span class="tooltip-container">
                  💡
                  <span class="tooltip-text"
                    >預設以指數型ETF的年化波動率設定，以台灣50、標普500為例，通常為15%~20%。</span
                  >
                </span>
                預期年化波動率（%）</label
              >
              <input
                type="number"
                id="annualVolatility"
                placeholder="例：15"
                value="15"
                min="0"
                max="50"
                step="0.5"
              />
            </div>
            <div class="form-group">
              <label for="annualInflation">平均年通膨率（%）</label>
              <input
                type="number"
                id="annualInflation"
                placeholder="例：2"
                value="2"
                min="0"
                max="10"
                step="0.5"
              />
            </div>
            <div class="form-group">
              <label for="targetNW">目標淨資產（萬元）</label>
              <input
                type="number"
                id="targetNW"
                placeholder="例：1000"
                value="1000"
                min="0"
              />
            </div>
            <div class="form-group">
              <label for="retireAge">預計退休年齡</label>
              <input
                type="number"
                id="retireAge"
                placeholder="例：65"
                value="65"
                min="0"
                max="100"
              />
            </div>
            <div class="form-group">
              <label for="withdrawAmount">
                <span class="tooltip-container">
                  💡
                  <span class="tooltip-text"
                    >退休當年提領金額，往後每年提領金額將隨通膨調整以維持實質購買力。</span
                  >
                </span>
                退休後每年提領金額（萬元）</label
              >
              <input
                type="number"
                id="withdrawAmount"
                placeholder="例：100"
                value="100"
                min="0"
              />
            </div>
          </div>

          <h2>🎯 槓桿倍數設定（每 5 年一區間）</h2>
          <div class="leverage-grid">
            <div class="form-group">
              <label for="lev2025">20~25 歲</label>
              <input
                type="number"
                id="lev2025"
                placeholder="例：1"
                value="1"
                min="1"
                max="3"
                step="0.01"
              />
            </div>
            <div class="form-group">
              <label for="lev2630">26~30 歲</label>
              <input
                type="number"
                id="lev2630"
                placeholder="例：1"
                value="1"
                min="1"
                max="3"
                step="0.01"
              />
            </div>
            <div class="form-group">
              <label for="lev3135">31~35 歲</label>
              <input
                type="number"
                id="lev3135"
                placeholder="例：1"
                value="1"
                min="1"
                max="3"
                step="0.01"
              />
            </div>
            <div class="form-group">
              <label for="lev3640">36~40 歲</label>
              <input
                type="number"
                id="lev3640"
                placeholder="例：1"
                value="1"
                min="1"
                max="3"
                step="0.01"
              />
            </div>
            <div class="form-group">
              <label for="lev4145">41~45 歲</label>
              <input
                type="number"
                id="lev4145"
                placeholder="例：1"
                value="1"
                min="1"
                max="3"
                step="0.01"
              />
            </div>
            <div class="form-group">
              <label for="lev4650">46~50 歲</label>
              <input
                type="number"
                id="lev4650"
                placeholder="例：1"
                value="1"
                min="1"
                max="3"
                step="0.01"
              />
            </div>
            <div class="form-group">
              <label for="lev5155">51~55 歲</label>
              <input
                type="number"
                id="lev5155"
                placeholder="例：1"
                value="1"
                min="1"
                max="3"
                step="0.01"
              />
            </div>
            <div class="form-group">
              <label for="lev5660">56~60 歲</label>
              <input
                type="number"
                id="lev5660"
                placeholder="例：1"
                value="1"
                min="1"
                max="3"
                step="0.01"
              />
            </div>
            <div class="form-group">
              <label for="lev6165">61~65 歲</label>
              <input
                type="number"
                id="lev6165"
                placeholder="例：1"
                value="1"
                min="1"
                max="3"
                step="0.01"
              />
            </div>
            <div class="form-group">
              <label for="lev66plus">66歲以上</label>
              <input
                type="number"
                id="lev66plus"
                placeholder="例：1"
                value="1"
                min="1"
                max="3"
                step="0.01"
              />
            </div>
          </div>

          <div class="action-buttons">
            <button class="btn-simulate btn-auto" onclick="autoSetLeverage()">
              ⚡ 自動設定建議槓桿倍數
            </button>
            <button class="btn-simulate btn-reset" onclick="resetLeverage()">
              🔄 取消槓桿
            </button>
          </div>

          <button class="btn-simulate btn-run" onclick="runSimulation()">
            🚀 開始模擬
          </button>
        </section>

        <section
          class="results-section"
          id="resultsSection"
          style="display: none"
        >
          <h2>📊 模擬結果</h2>
          <p class="simulation-description">
            本模擬方式套用蒙地卡羅模擬1000次人生路徑，分為樂觀、平均及悲觀三種情形。
          </p>
          <div class="results-grid">
            <div class="result-card scenario-card">
              <h3>悲觀情境 (P25)</h3>
              <div class="scenario-details">
                <p>
                  <strong>目標達成:</strong> <span id="targetResultP25"></span>
                </p>
                <p>
                  <strong>退休時資產:</strong>
                  <span id="retireResultP25"></span>
                </p>
                <p>
                  <strong>資金耗盡:</strong> <span id="deathResultP25"></span>
                </p>
              </div>
            </div>
            <div class="result-card scenario-card">
              <h3>平均情境 (P50)</h3>
              <div class="scenario-details">
                <p>
                  <strong>目標達成:</strong> <span id="targetResultP50"></span>
                </p>
                <p>
                  <strong>退休時資產:</strong>
                  <span id="retireResultP50"></span>
                </p>
                <p>
                  <strong>資金耗盡:</strong> <span id="deathResultP50"></span>
                </p>
              </div>
            </div>
            <div class="result-card scenario-card">
              <h3>樂觀情境 (P75)</h3>
              <div class="scenario-details">
                <p>
                  <strong>目標達成:</strong> <span id="targetResultP75"></span>
                </p>
                <p>
                  <strong>退休時資產:</strong>
                  <span id="retireResultP75"></span>
                </p>
                <p>
                  <strong>資金耗盡:</strong> <span id="deathResultP75"></span>
                </p>
              </div>
            </div>
          </div>
          <div class="investment-summary">
            <span
              >💵 總投入成本：<strong id="totalInvestmentResult"
                >計算中...</strong
              ></span
            >
            <span
              >🎯 目標淨資產達成率：<strong id="targetRateResult"
                >計算中...</strong
              ></span
            >
            <span
              >🛡️ 資金未耗盡成功率：<strong id="successRateResult"
                >計算中...</strong
              ></span
            >
          </div>

          <div class="chart-container">
            <canvas id="myChart"></canvas>
          </div>
        </section>

        <section class="references-section">
          <h2>📚 核心概念與參考文獻</h2>
          <ul class="reference-list">
            <li>
              <strong
                >Life-Cycle Investing and Leverage: Buying Stock on Margin Can
                Reduce Retirement Risk</strong
              >
              <p>
                投資風險應分散至整個生命週期，年輕時應透過使用槓桿增加股市曝險，藉此在相同風險下極大化退休財富
              </p>
            </li>
            <li>
              <strong
                >Daily leverage and long-term investing using leveraged exchange
                traded funds</strong
              >
              <p>生命週期投資法中，槓桿型ETF是否可作為增加曝險的合理工具</p>
            </li>
            <li>
              <strong
                >Retirement Savings: Choosing a Sustainable Withdrawal
                Rate</strong
              >
              <p>
                退休後每年提領的比例為總資產的4%(隨通膨調整)，高機率可於退休後30年內保持提領而不耗盡資產。
              </p>
            </li>
            <li>
              <strong
                >beyond the status quo a critical assessment of lifecycle
                investment advice</strong
              >
              <p>
                100%的多元化股票配置可極大化退休財富累積與降低資金耗盡風險。
              </p>
            </li>
          </ul>
        </section>
      </main>

      <footer>
        <p>💡 本工具僅供參考，實際投資結果可能因市場波動而異。</p>
      </footer>
    </div>

    <script src="simulator.js"></script>
  </body>
</html>
